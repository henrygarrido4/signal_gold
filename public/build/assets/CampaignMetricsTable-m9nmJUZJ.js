import{_ as N}from"./SaveToSnapshotButton-BiWKK4s4.js";import P from"./gridjs-2Vc4inXu.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as i,o as p,c as y,w as c,a as m,h as v,d as k,f as l,e as D,F as j}from"./app-BWABJYdq.js";const M={name:"CampaignMetricsTable",components:{SaveToSnapshotButton:N,GridJs:P},props:{metrics:{type:Object,default:()=>({totals:{},rates:{},trends:{},dailyMetrics:{}})},snapshots:{type:Array,required:!1,default:()=>[]},loading:{type:Boolean,default:!1},source:{type:String,default:"campaign"},selectedCampaign:{type:String,default:null}},computed:{campaignId(){var t;return((t=this.metrics)==null?void 0:t.campaign_id)||null},canSaveSnapshot(){return this.metrics&&Object.keys(this.metrics).length>0&&this.selectedCampaign},gridColumns(){return[{name:"Campaign Name",id:"campaign_name"},{name:"Delivered",id:"emails_delivered",formatter:t=>this.formatNumber(t)},{name:"Click Thrus",id:"clicks",formatter:t=>this.formatNumber(t)},{name:"Click Thru %",id:"click_rate",formatter:t=>`
            <span class="badge bg-${this.getPercentageClass(t)}">
              ${this.formatPercentage(t)}%
            </span>
          `},{name:"Entries",id:"entries",formatter:t=>this.formatNumber(t)},{name:"Leads",id:"leads",formatter:t=>this.formatNumber(t)},{name:"Conv. %",id:"conversion_rate",formatter:t=>`
            <span class="badge bg-${this.getPercentageClass(t)}">
              ${this.formatPercentage(t)}%
            </span>
          `}]},hasSnapshots(){return Array.isArray(this.snapshots)&&this.snapshots.length>0}},methods:{formatNumber(t){return new Intl.NumberFormat().format(t||0)},formatPercentage(t){return(t||0).toFixed(2)},getPercentageClass(t){return t?t>=0?"success":"danger":"secondary"},getStatusClass(t){switch(t){case"above_target":return"success";case"on_target":return"primary";case"below_target":return"warning";case"critical":return"danger";default:return"secondary"}},getStatusText(t){switch(t){case"above_target":return"Above Target";case"on_target":return"On Target";case"below_target":return"Below Target";case"critical":return"Critical";default:return"No Data"}},formatGridData(){return!this.metrics||!this.metrics.totals?[]:[{campaign_name:this.selectedCampaign||"Select a Campaign",emails_delivered:this.metrics.totals.emails_delivered,clicks:this.metrics.totals.total_clicks,click_rate:this.metrics.rates.click_through_rate,entries:this.metrics.totals.entries,leads:Math.round(this.metrics.totals.leads||0),conversion_rate:this.metrics.rates.conversion_rate}]},exportToCSV(){var u;if(!((u=this.metrics)!=null&&u.dailyMetrics)){console.log("No daily metrics data available");return}const t=["Date","Campaign Name","Delivered","Click Thrus","Click Thru %","Open Rate %","Click-to-Open %","Entries","Leads","Conversion %"],a=["Campaign Totals",this.selectedCampaign,this.metrics.totals.emails_delivered||0,this.metrics.totals.total_clicks||0,this.formatPercentage(this.metrics.rates.click_through_rate*100),this.formatPercentage(this.metrics.rates.open_rate*100),this.formatPercentage(this.metrics.rates.click_to_open_rate*100),this.metrics.totals.entries||0,Math.round(this.metrics.totals.leads||0),this.formatPercentage(this.metrics.rates.conversion_rate)].join(","),s=Object.entries(this.metrics.dailyMetrics).map(([o,n])=>{const r=n.metrics,[h,g]=[n.monthDate,n.dayDate],B=`${h}/${g}`,f=r.entries||0,b=r.totalLeads||0,T=f>0?b/f*100:0,w=(r.clickThruRate||0)*100,S=(r.openRate||0)*100,x=(r.clickToOpenRate||0)*100;return{date:new Date(2024,h-1,g),row:[B,this.selectedCampaign,r.totalDelivered||0,r.totalClicks||0,this.formatPercentage(w),this.formatPercentage(S),this.formatPercentage(x),f,Math.round(b),this.formatPercentage(T)].join(",")}}).sort((o,n)=>n.date-o.date).map(o=>o.row),_=[t.join(","),a,"",...s].join(`
`),C=new Blob([_],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a"),d=URL.createObjectURL(C);e.setAttribute("href",d),e.setAttribute("download",`${this.selectedCampaign||"campaign"}-metrics.csv`),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(d)}}},O={class:"d-flex justify-content-between align-items-center mb-4"},L={class:"d-flex gap-2"},A={key:1,class:"text-center py-4"};function V(t,a,s,_,C,e){const d=i("BCardTitle"),u=i("BCardHeader"),o=i("SaveToSnapshotButton"),n=i("BButton"),r=i("GridJs"),h=i("BCardBody"),g=i("BCard");return p(),y(g,{"no-body":""},{default:c(()=>[m(u,null,{default:c(()=>[m(d,null,{default:c(()=>a[0]||(a[0]=[v("Campaign Metrics")])),_:1})]),_:1}),m(h,null,{default:c(()=>[s.metrics&&s.metrics.totals?(p(),k(j,{key:0},[l("div",O,[a[2]||(a[2]=l("h4",{class:"card-title mb-0"},"Campaign Metrics",-1)),l("div",L,[e.canSaveSnapshot?(p(),y(o,{key:0,metrics:s.metrics,source:s.source||"campaign","campaign-name":s.selectedCampaign,"existing-snapshots":s.snapshots,"data-type":"campaign"},null,8,["metrics","source","campaign-name","existing-snapshots"])):D("",!0),m(n,{variant:"primary",size:"sm",onClick:e.exportToCSV},{default:c(()=>a[1]||(a[1]=[l("i",{class:"ri-download-2-line align-middle me-1"},null,-1),v(" Export ")])),_:1},8,["onClick"])])]),m(r,{data:e.formatGridData(),columns:e.gridColumns,search:!0,sort:!0,loading:s.loading},null,8,["data","columns","loading"])],64)):(p(),k("div",A,a[3]||(a[3]=[l("p",{class:"text-muted mb-0"},"Select a campaign to view metrics",-1)])))]),_:1})]),_:1})}const J=R(M,[["render",V]]);export{J as C};
