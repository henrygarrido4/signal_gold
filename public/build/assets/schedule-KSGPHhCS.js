import ft from"./date-selector-CMq4Jcmg.js";import{j as ht,c1 as yt,c2 as Ct,c3 as bt,c4 as Dt,H as et,r as o,c as st,w as m,o as d,a as c,f as e,k as h,d as u,g as lt,h as at,t as l,F as nt,n as St,e as wt}from"./app-BWABJYdq.js";import{L as xt}from"./main-BZMVmuB9.js";import{P as vt}from"./page-header-CWp0LBfO.js";import{_ as Bt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./component-GK_D4hhz.js";/* empty css                  */import"./simplebar-vue.esm-CZuBtKrH.js";import"./avatar-2-C9CWE8xV.js";import"./avatar-3-CcIxMpdW.js";import"./avatar-5-BPjc6EDL.js";import"./russia-pMTSjNGF.js";import"./logo-signal-9z7U6Iga.js";import"./logo-dark-BbIT5rJd.js";import"./logo-light-BfYujB8V.js";const kt={components:{DateSelector:ft,Link:ht,Layout:xt,PageHeader:vt,BDropdown:yt,BDropdownItem:Ct,BDropdownDivider:bt,BButtonGroup:Dt},props:{campaignId:{type:String,default:""},campaignOptions:{type:Array,required:!0},selectedCampaign:{type:String,default:""},allCampaignNames:{type:Array,default:()=>[]}},data(){return{date:null,config:{inline:!0,dateFormat:"Y-m-d",mode:"range"},campaignSearch:"",comparisonPeriod:"month",isCustomDropdownOpen:!1,periodOptions:[{value:"custom",text:"Custom Range"}],showDatePicker:!1,recentEvents:[],isLoadingGroups:!1,metrics:null,selectedDates:null}},computed:{selectedCampaignText(){return this.selectedCampaign?this.selectedCampaign:"Select Campaign"},filteredCampaigns(){return this.campaignSearch?[{value:null,text:"Select a campaign"},...this.allCampaignNames.filter(s=>s.toLowerCase().includes(this.campaignSearch.toLowerCase())).map(s=>({value:s,text:s}))]:this.campaignOptions},isReadyToFetch(){return this.selectedCampaign&&this.date&&(Array.isArray(this.date)?this.date.length===2:!0)}},methods:{async logDateSelection(s){var t,i;try{await et.post("/api/campaign-logs",{campaign_id:this.campaignId,action:"date_selection",start_date:s.start,end_date:s.end,timestamp:new Date().toISOString(),user_id:(i=(t=window==null?void 0:window.Laravel)==null?void 0:t.user)==null?void 0:i.id})}catch(p){console.error("Failed to log date selection:",p)}},handlePeriodSelection(s){var t;(t=this.$refs.tableau)==null||t.getAvailableFields(),this.$emit("period-selected",{start:s.start,end:s.end})},updatePeriod(s){this.comparisonPeriod=s;const t=new Date;let i=new Date,p=t;switch(s){case"mtd":i=new Date(t.getFullYear(),t.getMonth(),1);break;case"ytd":i=new Date(t.getFullYear(),0,1);break}s!=="custom"&&this.handlePeriodSelection({start:i,end:p})},activateCustomRange(s){s.preventDefault(),s.stopPropagation(),this.comparisonPeriod="custom",this.isCustomDropdownOpen=!0},getDateDisplayText(){if(!this.date||this.date.length!==2)return"ðŸ“… Select Date Range";const s=new Date(this.date[0]).toLocaleDateString(),t=new Date(this.date[1]).toLocaleDateString();return`${s} - ${t}`},fetchData(){var t;if(!this.isReadyToFetch)return;const s=Array.isArray(this.date)?{start:new Date(this.date[0]),end:new Date(this.date[1])}:this.date;this.$emit("fetch-data",{campaignId:this.selectedCampaign,dates:s}),(t=this.$toast)==null||t.success("Fetching campaign data...")},async fetchRecentEvents(){var s;try{const t=await et.get("/api/campaign-logs",{params:{recent:!0},headers:{"X-Requested-With":"XMLHttpRequest"}});this.recentEvents=t.data.data}catch(t){console.error("Failed to fetch recent events:",t),((s=t.response)==null?void 0:s.status)===401&&(window.location.href="/login")}},handleCampaignSelect(s){this.$emit("update:selected-campaign",s)},async updateCampaignNames(s){this.allCampaignNames=s,this.campaignOptions=[{value:null,text:"Select a campaign"},...s.slice(0,6).map(t=>({value:t,text:t}))]},handleDateSelection(s){this.selectedDates=s,this.$emit("date-selection",s)}},mounted(){this.fetchRecentEvents()}},_t={class:"d-flex flex-column gap-2"},Lt={class:"mb-4"},Rt={class:"mb-4"},Ft={key:0,class:"text-center mt-3"},Pt={class:"flex-shrink-0 avatar-sm"},Mt={class:"mini-stat-icon avatar-title rounded-circle text-success bg-success-subtle fs-4"},Ot={class:"flex-grow-1 ms-3"},Tt={class:"mb-1"},Et={class:"text-muted mb-0"},It={class:"flex-shrink-0"},Nt={class:"text-muted mb-0"},At={class:"text-uppercase"},Vt={key:2,class:"campaign-metrics mt-4"},qt={class:"table-responsive"},Ut={class:"table table-sm"};function Ht(s,t,i,p,a,g){const it=o("BFormInput"),rt=o("BDropdownDivider"),ot=o("BDropdownItem"),dt=o("BDropdown"),ct=o("BButtonGroup"),mt=o("DateSelector"),ut=o("BCardHeader"),pt=o("BCardBody"),gt=o("BCard");return d(),st(gt,{"no-body":""},{default:m(()=>[c(ut,{class:"border-0"},{default:m(()=>[e("div",_t,[e("div",Lt,[t[4]||(t[4]=e("label",{class:"form-label"},"Select Campaign",-1)),c(ct,{class:"w-100"},{default:m(()=>[c(dt,{variant:"primary",text:i.selectedCampaign||"Select Campaign",class:"w-100"},{default:m(()=>[e("div",{class:"px-3 py-2",onClick:t[3]||(t[3]=h(()=>{},["stop"]))},[c(it,{modelValue:a.campaignSearch,"onUpdate:modelValue":t[0]||(t[0]=r=>a.campaignSearch=r),type:"search",placeholder:"Search campaigns...",class:"form-control",onClick:t[1]||(t[1]=h(()=>{},["stop"])),onKeydown:t[2]||(t[2]=h(()=>{},["stop"]))},null,8,["modelValue"])]),c(rt),(d(!0),u(nt,null,lt(g.filteredCampaigns,r=>(d(),st(ot,{key:r.value,onClick:f=>g.handleCampaignSelect(r.value),active:i.selectedCampaign===r.value},{default:m(()=>[at(l(r.text),1)]),_:2},1032,["onClick","active"]))),128))]),_:1},8,["text"])]),_:1})]),e("div",Rt,[t[5]||(t[5]=e("label",{class:"form-label"},"Select Date Range",-1)),c(mt,{onPeriodSelected:g.handlePeriodSelection,disabled:!i.selectedCampaign},null,8,["onPeriodSelected","disabled"])])])]),_:1}),c(pt,{class:"pt-0"},{default:m(()=>{var r,f,y,C,b,D,S,w,x,v,B,k,_,L,R,F,P,M,O,T,E,I,N,A,V,q,U,H,G,Y,X,j,z,K,Q,W,J,Z,$,tt;return[t[23]||(t[23]=e("h6",{class:"text-uppercase fw-semibold mt-4 mb-3 text-muted"},"Events:",-1)),a.recentEvents.length===0?(d(),u("div",Ft,t[6]||(t[6]=[e("p",{class:"text-muted mb-0"},"No upcoming events",-1)]))):(d(!0),u(nt,{key:1},lt(a.recentEvents,n=>(d(),u("div",{key:n.date,class:"mini-stats-wid d-flex align-items-center mt-3"},[e("div",Pt,[e("span",Mt,l(n.date),1)]),e("div",Ot,[e("h6",Tt,l(n.title),1),e("p",Et,l(n.company),1),e("span",{class:St(["badge rounded-pill mt-1",{"text-success bg-success-subtle":n.status==="running","text-warning bg-warning-subtle":n.status==="scheduled","text-info bg-info-subtle":n.status==="completed","text-primary bg-primary-subtle":n.status==="pending"}])},l(n.status.charAt(0).toUpperCase()+n.status.slice(1)),3)]),e("div",It,[e("p",Nt,[at(l(n.time)+" ",1),e("span",At,l(n.period),1)])])]))),128)),a.metrics?(d(),u("div",Vt,[t[22]||(t[22]=e("h6",null,"Campaign Performance",-1)),e("div",qt,[e("table",Ut,[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",null,"Metric"),e("th",null,"Value")])],-1)),e("tbody",null,[e("tr",null,[t[7]||(t[7]=e("td",null,"Total Sends",-1)),e("td",null,l(((C=(y=(f=(r=a.metrics.dailyMetrics)==null?void 0:r[0])==null?void 0:f.metrics)==null?void 0:y.totalSends)==null?void 0:C.toLocaleString())||0),1)]),e("tr",null,[t[8]||(t[8]=e("td",null,"Delivered",-1)),e("td",null,l(((D=(b=a.metrics.totals)==null?void 0:b.emails_delivered)==null?void 0:D.toLocaleString())||0),1)]),e("tr",null,[t[9]||(t[9]=e("td",null,"Delivery Rate",-1)),e("td",null,l((((S=a.metrics.rates)==null?void 0:S.delivery_rate)||0).toFixed(2))+"%",1)]),e("tr",null,[t[10]||(t[10]=e("td",null,"Unique Opens",-1)),e("td",null,l(((B=(v=(x=(w=a.metrics.dailyMetrics)==null?void 0:w[0])==null?void 0:x.metrics)==null?void 0:v.uniqueOpenClicks)==null?void 0:B.toLocaleString())||0),1)]),e("tr",null,[t[11]||(t[11]=e("td",null,"Open Rate",-1)),e("td",null,l((((L=(_=(k=a.metrics.dailyMetrics)==null?void 0:k[0])==null?void 0:_.metrics)==null?void 0:L.openRate)||0).toFixed(2))+"%",1)]),e("tr",null,[t[12]||(t[12]=e("td",null,"Total Clicks",-1)),e("td",null,l(((M=(P=(F=(R=a.metrics.dailyMetrics)==null?void 0:R[0])==null?void 0:F.metrics)==null?void 0:P.totalClicks)==null?void 0:M.toLocaleString())||0),1)]),e("tr",null,[t[13]||(t[13]=e("td",null,"Click-to-Open Rate",-1)),e("td",null,l((((E=(T=(O=a.metrics.dailyMetrics)==null?void 0:O[0])==null?void 0:T.metrics)==null?void 0:E.clickToOpenRate)||0).toFixed(2))+"%",1)]),e("tr",null,[t[14]||(t[14]=e("td",null,"Click Through Rate",-1)),e("td",null,l((((A=(N=(I=a.metrics.dailyMetrics)==null?void 0:I[0])==null?void 0:N.metrics)==null?void 0:A.clickThruRate)||0).toFixed(2))+"%",1)]),e("tr",null,[t[15]||(t[15]=e("td",null,"Unsubscribes",-1)),e("td",null,l(((H=(U=(q=(V=a.metrics.dailyMetrics)==null?void 0:V[0])==null?void 0:q.metrics)==null?void 0:U.uniqueUnsubscribers)==null?void 0:H.toLocaleString())||0),1)]),e("tr",null,[t[16]||(t[16]=e("td",null,"Unsubscribe Rate",-1)),e("td",null,l((((X=(Y=(G=a.metrics.dailyMetrics)==null?void 0:G[0])==null?void 0:Y.metrics)==null?void 0:X.unsubscribeRate)||0).toFixed(2))+"%",1)]),e("tr",null,[t[17]||(t[17]=e("td",null,"Entries",-1)),e("td",null,l(((z=(j=a.metrics.totals)==null?void 0:j.entries)==null?void 0:z.toLocaleString())||0),1)]),e("tr",null,[t[18]||(t[18]=e("td",null,"Dealer Leads",-1)),e("td",null,l(((J=(W=(Q=(K=a.metrics.dailyMetrics)==null?void 0:K[0])==null?void 0:Q.metrics)==null?void 0:W.dealerLeads)==null?void 0:J.toLocaleString())||0),1)]),e("tr",null,[t[19]||(t[19]=e("td",null,"Total Leads",-1)),e("td",null,l((($=(Z=a.metrics.totals)==null?void 0:Z.leads)==null?void 0:$.toLocaleString())||0),1)]),e("tr",null,[t[20]||(t[20]=e("td",null,"Conversion Rate",-1)),e("td",null,l((((tt=a.metrics.rates)==null?void 0:tt.conversion_rate)||0).toFixed(2))+"%",1)])])])])])):wt("",!0)]}),_:1})]),_:1})}const ae=Bt(kt,[["render",Ht]]);export{ae as default};
