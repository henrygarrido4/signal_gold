import{o as g,d as C,f as c,F as L,g as $,t as k,n as R,r as o,c as x,w as r,a as i,h as S,e as M}from"./app-BWABJYdq.js";import{L as U}from"./main-BZMVmuB9.js";import{P as q}from"./page-header-CWp0LBfO.js";import A from"./widget-DEBdsC2a.js";import I from"./widget2-PdYx6S9X.js";import E from"./projects-DQaK118M.js";import V from"./chart-PkHSgNVK.js";import j from"./schedule-KSGPHhCS.js";import H from"./forecast-8soYRrJm.js";import W from"./deal-type-DzSYC__O.js";import Y from"./balance-overview-C8_E4hzD.js";import G from"./deals-status-DeFLesyN.js";import J from"./tasks-C7AZWaa3.js";import K from"./activities-BjjmeWfR.js";import Q from"./closing-deals-C6YK48s_.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as X}from"./CampaignMetricsTable-m9nmJUZJ.js";import Z from"./date-selector-CMq4Jcmg.js";import ee from"./analytics-widget-34yIofio.js";import{T as te,t as T}from"./TableauDashboard-D3BqF5WG.js";import"./simplebar-vue.esm-CZuBtKrH.js";import"./avatar-2-C9CWE8xV.js";import"./avatar-3-CcIxMpdW.js";import"./avatar-5-BPjc6EDL.js";import"./russia-pMTSjNGF.js";import"./logo-signal-9z7U6Iga.js";import"./logo-dark-BbIT5rJd.js";import"./logo-light-BfYujB8V.js";import"./vue3-count-to.esm-CLX3ExJ9.js";import"./vue-feather-icons.es-DhCg6NIe.js";import"./getChartColorsArray-DXKIp7ac.js";import"./avatar-1-oDBKIU2x.js";import"./avatar-4-rms8IJmS.js";import"./avatar-6-B0PpuAZw.js";import"./avatar-7-S7rLa7v8.js";import"./avatar-8-CIXqINoD.js";import"./SaveToSnapshotButton-BiWKK4s4.js";import"./component-GK_D4hhz.js";/* empty css                  */import"./sweetalert2.esm.all-CumHaNCI.js";import"./gridjs-2Vc4inXu.js";const ae={data(){return{upcomingEvents:[{id:1,title:"Product Launch Campaign",date:"10 May 2024",icon:"rocket-2-line",color:"primary"}]}}},ie={class:"upcoming-scheduled"},se={class:"upcoming-events"},re={class:"d-flex"},ne={class:"flex-grow-1"},oe={class:"mb-1"},le={class:"text-muted mb-0"},ce={class:"flex-shrink-0"};function de(e,t,n,s,a,u){return g(),C("div",ie,[t[1]||(t[1]=c("div",{class:"mini-calendar mb-4"},null,-1)),c("div",se,[t[0]||(t[0]=c("h5",{class:"mb-3"},"Upcoming Campaigns",-1)),(g(!0),C(L,null,$(a.upcomingEvents,m=>(g(),C("div",{class:"scheduled-event mb-3",key:m.id},[c("div",re,[c("div",ne,[c("h6",oe,k(m.title),1),c("p",le,k(m.date),1)]),c("div",ce,[c("i",{class:R(`ri-${m.icon} text-${m.color}`)},null,2)])])]))),128))])])}const me=B(ae,[["render",de]]),pe={components:{Layout:U,PageHeader:q,Widget:A,Widget2:I,Project:E,Chart:V,Schedules:j,SalesForecast:H,DealType:W,BalanceOverview:Y,DealStatus:G,Tasks:J,UpcomingActivity:K,ClosingDeals:Q,CampaignSchedule:me,CampaignMetricsTable:X,DateSelector:Z,AnalyticsWidget:ee,TableauDashboard:te},data(){return{selectedCampaign:"",dateRange:"",comparisonPeriod:"month",showDatePicker:!1,snapshots:[],campaigns:[{value:"",text:"Select a campaign"},{value:"campaign1",text:"Campaign 1"},{value:"campaign2",text:"Campaign 2"},{value:"campaign3",text:"Campaign 3"}],campaignAMetrics:{totals:{emails_delivered:0,entries:0,leads:0},rates:{conversion_rate:0},trends:{delivery_rate:0,entry_rate:0,lead_rate:0,conversion_trend:0}},analyticsData:{},campaignSearch:"",periodSearch:"",startDate:"",endDate:"",periodOptions:[{value:"day",text:"Day over Day"},{value:"month",text:"Month over Month"},{value:"year",text:"Year over Year"},{value:"custom",text:"Custom Range"}],metrics:{currentPeriod:{totals:{emails_delivered:0,entries:0,leads:0},rates:{conversion_rate:0},trends:{delivery_rate:0,entry_rate:0,lead_rate:0,conversion_trend:0}},previousPeriod:{totals:{emails_sent:0,emails_delivered:0,emails_opened:0,clicks:0,visitors:0,entries:0,leads:0,conversions:0},rates:{delivery_rate:0,open_rate:0,click_through_rate:0,conversion_rate:0,lead_conversion_rate:0}},mtd:{},wow:{},yoy:{},status:{}},loading:!1,campaignOptions:[{value:null,text:"Select a campaign"}],isTableauLoading:!0,isDashboardMinimized:!0,allCampaignNames:[],campaignMetrics:{},showSignInAlert:!1}},computed:{filteredCampaigns(){const e=this.campaignSearch.toLowerCase();return this.campaigns.filter(t=>t.text.toLowerCase().includes(e))},filteredPeriods(){const e=this.periodSearch.toLowerCase();return this.periodOptions.filter(t=>t.text.toLowerCase().includes(e))}},methods:{async fetchMetrics(){},handlePeriodSelection({start:e,end:t}){this.startDate=this.formatDate(e),this.endDate=this.formatDate(t),this.dateRange=`${this.startDate} to ${this.endDate}`,this.fetchMetrics()},formatDate(e){return e.toISOString().split("T")[0]},downloadCampaignData(){window.location.href=`/campaign-performance/download?campaign=${this.selectedCampaign}&start_date=${this.dateRange.start}&end_date=${this.dateRange.end}`},async handleFetchData({campaignId:e,dates:t}){var n;try{this.loading=!0;const s=await axios.get("/api/campaign-metrics",{params:{campaign_id:e,start_date:t.start.toISOString().split("T")[0],end_date:t.end.toISOString().split("T")[0]}});this.metrics=s.data,this.campaignAMetrics=s.data.currentPeriod}catch(s){console.error("Failed to fetch campaign data:",s),(n=this.$toast)==null||n.error("Failed to fetch campaign data")}finally{this.loading=!1}},async handleCampaignNamesUpdated(e){this.campaignNames=e;const t=await T.getCampaignMetrics(e);this.campaignMetrics=t,this.allCampaignNames=e;const n=e.slice(0,6);this.campaignOptions=[{value:null,text:"Select a campaign"},...n.map(s=>({value:s,text:s}))]},async handleDateSelection({start:e,end:t}){var n,s;try{this.loading=!0,await((n=this.$refs.tableau)==null?void 0:n.getAvailableFields()),(s=this.$refs.tableau)!=null&&s.isVizReady&&(await this.$refs.tableau.applyFilter("Date",[e,t]),this.selectedCampaign&&await this.updateCampaignMetrics())}catch(a){console.error("Failed to update date range:",a)}finally{this.loading=!1}},updateTableauFilter(e,t){var n;if((n=this.$refs.tableau)!=null&&n.isVizReady)if(e==="Date"){const s=t.map(a=>new Date(a).toISOString().split("T")[0]);this.$refs.tableau.applyFilter(e,s)}else this.$refs.tableau.applyFilter(e,t);else console.warn("⚠ Cannot apply filter: Tableau is not ready yet.")},clearTableauFilters(){var e;(e=this.$refs.tableau)!=null&&e.isVizReady?(this.$refs.tableau.clearFilter("Campaign Name"),this.$refs.tableau.clearFilter("Date")):console.warn("⚠ Cannot clear filters: Tableau is not ready yet.")},async handleCampaignSelect(e){var t,n,s;try{if(this.loading=!0,this.selectedCampaign=e,e){await T.applyFilter("Campaign Name",[e]);const a=await T.getCampaignMetrics([e]);if(a[e]){const u=a[e],m=u.dailyMetrics,l=Object.values(m).reduce((p,_)=>{const d=_.metrics;return{totalSends:(p.totalSends||0)+(d.totalSends||0),totalDelivered:(p.totalDelivered||0)+(d.totalDelivered||0),totalClicks:(p.totalClicks||0)+(d.totalClicks||0),uniqueOpenClicks:(p.uniqueOpenClicks||0)+(d.uniqueOpenClicks||0),uniqueUnsubscribers:(p.uniqueUnsubscribers||0)+(d.uniqueUnsubscribers||0)}},{}),h={clickThruRate:l.totalClicks/l.totalDelivered,openRate:l.uniqueOpenClicks/l.totalDelivered,clickToOpenRate:0,deliveryRate:l.totalDelivered/l.totalSends,unsubscribeRate:l.uniqueUnsubscribers/l.totalDelivered},b=Object.values(m).map(p=>p.metrics.clickToOpenRate),D=b.reduce((p,_)=>p+_,0)/b.length*100;h.clickToOpenRate=D,this.metrics={campaign_id:e,totals:{emails_sent:l.totalSends||0,emails_delivered:l.totalDelivered||0,entries:((t=u.totals)==null?void 0:t.entries)||0,leads:((n=u.totals)==null?void 0:n.leads)||0,total_clicks:l.totalClicks||0,unique_opens:l.uniqueOpenClicks||0},rates:{conversion_rate:((s=u.rates)==null?void 0:s.conversion_rate)||0,click_through_rate:h.clickThruRate*100||0,open_rate:h.openRate*100||0,click_to_open_rate:h.clickToOpenRate||0,delivery_rate:h.deliveryRate*100||0,unsubscribe_rate:h.unsubscribeRate*100||0},trends:u.trends||{},dailyMetrics:m},this.campaignAMetrics={totals:this.metrics.totals,rates:this.metrics.rates,trends:this.metrics.trends}}}}catch(a){console.error("Failed to update campaign:",a)}finally{this.loading=!1}},async updateCampaignMetrics(){this.selectedCampaign&&await this.handleCampaignSelect(this.selectedCampaign)}},watch:{comparisonPeriod(e){this.showDatePicker=e==="custom",e!=="custom"&&(this.dateRange="",this.startDate="",this.endDate="")},selectedCampaign:{async handler(e){e?(this.updateTableauFilter("Campaign Name",[e]),await this.handleCampaignSelect(e)):this.clearTableauFilters()}}},mounted(){this.fetchMetrics(),setTimeout(()=>{var e;(e=this.$refs.tableau)!=null&&e.isVizReady||(this.showSignInAlert=!0)},5e3)}},ue={class:"d-flex justify-content-between align-items-center"},he={class:"d-flex align-items-center"},ge={class:"ms-2"},_e={key:1,class:"text-muted"},fe={key:0,class:"alert alert-warning m-3 d-flex align-items-center",role:"alert"};function Ce(e,t,n,s,a,u){const m=o("PageHeader"),l=o("BCardTitle"),h=o("BSpinner"),b=o("BButton"),w=o("BCardHeader"),D=o("TableauDashboard"),p=o("BCardBody"),_=o("BCard"),d=o("BCol"),f=o("BRow"),O=o("Widget"),F=o("Schedules"),z=o("Chart"),P=o("CampaignMetricsTable"),N=o("Layout");return g(),x(N,null,{default:r(()=>[i(m,{title:"CRM",pageTitle:"Dashboards"}),i(f,{class:"mb-4"},{default:r(()=>[i(d,{cols:"12"},{default:r(()=>[i(_,{"no-body":""},{default:r(()=>{var y;return[i(w,null,{default:r(()=>{var v;return[c("div",ue,[c("div",he,[i(l,{class:"mb-0"},{default:r(()=>t[3]||(t[3]=[S("Email Analytics Dashboard")])),_:1}),c("div",ge,[a.isTableauLoading?(g(),x(h,{key:0,small:"",variant:"primary"})):(v=e.$refs.tableau)!=null&&v.isVizReady?M("",!0):(g(),C("small",_e," (Not signed in) "))])]),i(b,{variant:"soft-primary",size:"sm",onClick:t[0]||(t[0]=be=>a.isDashboardMinimized=!a.isDashboardMinimized)},{default:r(()=>[c("i",{class:R(a.isDashboardMinimized?"ri-fullscreen-line":"ri-fullscreen-exit-line")},null,2),S(" "+k(a.isDashboardMinimized?"Expand":"Minimize"),1)]),_:1})])]}),_:1}),a.showSignInAlert&&!((y=e.$refs.tableau)!=null&&y.isVizReady)&&a.isDashboardMinimized?(g(),C("div",fe,t[4]||(t[4]=[c("i",{class:"ri-error-warning-line me-2"},null,-1),S(" Please verify that you are signed in to Tableau Cloud. If you're already signed in, the visualization may take a moment to load. ")]))):M("",!0),i(p,null,{default:r(()=>[i(D,{ref:"tableau",vizUrl:"https://us-west-2b.online.tableau.com/t/cars/views/EmailDashboards/EmailDashboard",height:a.isDashboardMinimized?"0":"800",onCampaignNamesUpdated:u.handleCampaignNamesUpdated,onLoading:t[1]||(t[1]=v=>a.isTableauLoading=v)},null,8,["height","onCampaignNamesUpdated"])]),_:1})]}),_:1})]),_:1})]),_:1}),i(f,null,{default:r(()=>[i(d,{xl:"12"},{default:r(()=>[i(O,{metrics:a.metrics},null,8,["metrics"])]),_:1})]),_:1}),i(f,{class:"project-wrapper"},{default:r(()=>[i(d,{cols:"12",xxl:"4"},{default:r(()=>[i(F,{"campaign-options":a.campaignOptions,"selected-campaign":a.selectedCampaign,"all-campaign-names":a.allCampaignNames,"onUpdate:selectedCampaign":t[2]||(t[2]=y=>a.selectedCampaign=y),onPeriodSelected:u.handleDateSelection},null,8,["campaign-options","selected-campaign","all-campaign-names","onPeriodSelected"])]),_:1}),i(d,{cols:"12",xxl:"8"},{default:r(()=>[i(f,null,{default:r(()=>[i(d,{xl:"12"},{default:r(()=>[i(z,{metrics:a.metrics,"selected-period":{startDate:a.startDate,endDate:a.endDate}},null,8,["metrics","selected-period"])]),_:1})]),_:1})]),_:1})]),_:1}),i(f,{class:"mt-4"},{default:r(()=>[i(d,{lg:"12"},{default:r(()=>[i(P,{metrics:a.metrics,"selected-campaign":a.selectedCampaign,snapshots:a.snapshots},null,8,["metrics","selected-campaign","snapshots"])]),_:1})]),_:1})]),_:1})}const ot=B(pe,[["render",Ce]]);export{ot as default};
