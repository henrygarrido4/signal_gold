import{b as B,m as F,r as m,o as k,d as N,a as n,w as l,f as O,h as S,c as M,e as T,t as j,k as D}from"./app-BWABJYdq.js";import"./component-GK_D4hhz.js";/* empty css                  */import{S as y}from"./sweetalert2.esm.all-CumHaNCI.js";const $={__name:"SaveToSnapshotButton",props:{metrics:{type:Object,default:()=>({})},source:{type:String,default:"campaign",validator:g=>["analytics","campaign"].includes(g)},campaignName:{type:String,required:!0}},setup(g){const a=g,p=B(!1),c=B(!1),s=B({name:"",notes:""}),x=F(()=>a.metrics&&Object.keys(a.metrics).length>0&&a.campaignName),_=()=>{s.value={name:"",notes:""}},C=t=>{y.fire({title:"Success!",text:t,icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0})},h=t=>{y.fire({title:"Error!",text:t,icon:"error",confirmButtonColor:"#34c38f",confirmButtonText:"Ok"})},b=t=>{y.fire({title:"Warning",text:t,icon:"warning",confirmButtonColor:"#34c38f",confirmButtonText:"Ok"})},w=async()=>{var t,e,u,f,d,v;if(!a.metrics||Object.keys(a.metrics).length===0){b("No metrics data available to save");return}if(!a.campaignName){b("Campaign name is required");return}c.value=!0;try{const o=new Date,r=new Date(o);r.setDate(r.getDate()+1);const V=await axios.post("/api/campaign-snapshots",{name:s.value.name||`${a.campaignName} Snapshot`,notes:s.value.notes,campaign_id:a.metrics.campaign_id,period_type:"daily",metrics_data:a.metrics});p.value=!1,_(),C("Snapshot saved successfully")}catch(o){if(console.error("Failed to save snapshot:",o),console.log("Validation errors:",(e=(t=o.response)==null?void 0:t.data)==null?void 0:e.errors),(f=(u=o.response)==null?void 0:u.data)!=null&&f.errors){const r=Object.values(o.response.data.errors).flat();h(r.join(`
`))}else{const r=((v=(d=o.response)==null?void 0:d.data)==null?void 0:v.message)||"Failed to save snapshot";h(r)}}finally{c.value=!1}};return(t,e)=>{const u=m("BButton"),f=m("BFormInput"),d=m("BFormGroup"),v=m("BFormTextarea"),o=m("BForm"),r=m("BSpinner"),V=m("BModal");return k(),N("div",null,[n(u,{variant:"soft-primary",size:"sm",onClick:e[0]||(e[0]=i=>p.value=!0),disabled:!x.value},{default:l(()=>e[5]||(e[5]=[O("i",{class:"ri-save-line align-middle me-1"},null,-1),S(" Save Snapshot ")])),_:1},8,["disabled"]),n(V,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=i=>p.value=i),title:"Save Campaign Snapshot",onHidden:_},{footer:l(()=>[n(u,{variant:"secondary",onClick:e[3]||(e[3]=i=>p.value=!1)},{default:l(()=>e[6]||(e[6]=[S(" Cancel ")])),_:1}),n(u,{variant:"primary",onClick:w,disabled:c.value||!s.value.name},{default:l(()=>[c.value?(k(),M(r,{key:0,small:"",class:"me-1"})):T("",!0),S(" "+j(c.value?"Saving...":"Save Snapshot"),1)]),_:1},8,["disabled"])]),default:l(()=>[n(o,{onSubmit:D(w,["prevent"])},{default:l(()=>[n(d,{label:"Name","label-for":"snapshot-name"},{default:l(()=>[n(f,{id:"snapshot-name",modelValue:s.value.name,"onUpdate:modelValue":e[1]||(e[1]=i=>s.value.name=i),required:"",placeholder:"Enter snapshot name"},null,8,["modelValue"])]),_:1}),n(d,{label:"Notes","label-for":"snapshot-notes"},{default:l(()=>[n(v,{id:"snapshot-notes",modelValue:s.value.notes,"onUpdate:modelValue":e[2]||(e[2]=i=>s.value.notes=i),rows:"3",placeholder:"Optional notes about this snapshot"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{$ as _};
