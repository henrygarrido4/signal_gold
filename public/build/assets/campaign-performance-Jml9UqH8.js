import{_ as y}from"./SaveToSnapshotButton-BiWKK4s4.js";import{C as k}from"./CampaignMetricsTable-m9nmJUZJ.js";import{b as h,s as B,A as S,r as p,d as R,f as e,a as s,w as n,H as P,o as T,t as c,n as v}from"./app-BWABJYdq.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./component-GK_D4hhz.js";/* empty css                  */import"./sweetalert2.esm.all-CumHaNCI.js";import"./gridjs-2Vc4inXu.js";const F={components:{SaveToSnapshotButton:y,CampaignMetricsTable:k},props:{campaign:{type:String,default:""},comparisonPeriod:{type:String,default:"month"},analyticsData:{type:Object,default:()=>({})}},setup(a){const t=h({series:[{name:"Current Period",data:[]},{name:"Previous Period",data:[]}],chartOptions:{chart:{type:"line",height:350,toolbar:{show:!1}},stroke:{width:[3,3],curve:"smooth"},colors:["#4b38b3","#45cb85"],fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,opacityFrom:1,opacityTo:1,stops:[0,100]}},markers:{size:4,hover:{size:6}},xaxis:{type:"datetime"},yaxis:{title:{text:"Conversion Rate (%)"}}}}),d=h({currentPeriod:{totals:{emails_sent:0,emails_delivered:0,emails_opened:0,clicks:0,visitors:0,entries:0,leads:0,conversions:0},rates:{delivery_rate:0,open_rate:0,click_through_rate:0,conversion_rate:0,lead_conversion_rate:0}},previousPeriod:{totals:{emails_sent:0,emails_delivered:0,emails_opened:0,clicks:0,visitors:0,entries:0,leads:0,conversions:0},rates:{delivery_rate:0,open_rate:0,click_through_rate:0,conversion_rate:0,lead_conversion_rate:0}}}),o=h([]),l=h({}),r=h([]),x=h([]),u=async()=>{if(!a.campaign){console.log("No campaign selected");return}try{const g=(await P.get("/api/campaign-performance",{params:{campaign_names:[a.campaign]}})).data;d.value.currentPeriod=f(g),d.value.previousPeriod=m(g),t.value.series=[{name:"Current Period",data:_(d.value.currentPeriod)},{name:"Previous Period",data:_(d.value.previousPeriod)}],o.value=b(d.value),w()}catch(i){console.error("Failed to fetch campaign data:",i)}},f=i=>({}),m=i=>({}),_=i=>i.map(g=>({x:new Date(g.date).getTime(),y:g.conversion_rate})),b=i=>[{label:"Emails Sent",current:i.currentPeriod.emails_sent,previous:i.previousPeriod.emails_sent,change:C(i.currentPeriod.emails_sent,i.previousPeriod.emails_sent)}],C=(i,g)=>g?Number(((i-g)/g*100).toFixed(2)):0,w=async()=>{try{const i=await P.get(`/api/campaign-analysis/${a.campaign}`);l.value=i.data.kpis,r.value=i.data.trends,x.value=i.data.anomalies}catch(i){console.error("Failed to fetch analysis data:",i)}};return B(()=>{u()}),S(()=>a.campaign,()=>{u()}),{performanceData:t,metrics:d,detailedMetrics:o,kpis:l,trends:r,anomalies:x}},methods:{getPercentageClass(a){return a>0?"badge-soft-success":"badge-soft-danger"},processComparisonData(a){const t=[],d=a.filter(l=>l.campaign_name===this.selectedCampaigns[0]),o=a.filter(l=>l.campaign_name===this.selectedCampaigns[1]);return t.push({metric:"Emails Sent",campaignA:d.reduce((l,r)=>l+r.emails_sent,0),campaignB:o.reduce((l,r)=>l+r.emails_sent,0),variance:this.calculateVariance(d.reduce((l,r)=>l+r.emails_sent,0),o.reduce((l,r)=>l+r.emails_sent,0))}),t},calculateVariance(a,t){return t===0?"0%":`${((a-t)/t*100).toFixed(2)}%`},formatMetric(a){return new Intl.NumberFormat().format(a||0)},formatChange(a){return`${(a||0).toFixed(2)}%`},getChangeClass(a){return a?a>=0?"success":"danger":"secondary"},formatNumber(a){return new Intl.NumberFormat().format(a||0)},formatPercentage(a){return(a||0).toFixed(2)},getStatusClass(a){switch(a){case"above_target":return"success";case"on_target":return"primary";case"below_target":return"warning";case"critical":return"danger";default:return"secondary"}},getStatusText(a){switch(a){case"above_target":return"Above Target";case"on_target":return"On Target";case"below_target":return"Below Target";case"critical":return"Critical";default:return"No Data"}}},computed:{emailSentChange(){const a=this.metrics.currentPeriod.totals.emails_sent,t=this.metrics.previousPeriod.totals.emails_sent;return t?(a-t)/t*100:0},openRateChange(){const a=this.metrics.currentPeriod.rates.open_rate,t=this.metrics.previousPeriod.rates.open_rate;return t?(a-t)/t*100:0},clickRateChange(){const a=this.metrics.currentPeriod.rates.click_through_rate,t=this.metrics.previousPeriod.rates.click_through_rate;return t?(a-t)/t*100:0}}},N={class:"d-flex justify-content-between align-items-center mb-4"},M={class:"d-flex align-items-center"},A={class:"flex-grow-1"},O={class:"d-flex align-items-center mb-2"},z={class:"fs-4 flex-grow-1 mb-0"},E={class:"d-flex align-items-center"},V={class:"flex-grow-1"},I={class:"d-flex align-items-center mb-2"},j={class:"fs-4 flex-grow-1 mb-0"},H={class:"d-flex align-items-center"},q={class:"flex-grow-1"},G={class:"d-flex align-items-center mb-2"},J={class:"fs-4 flex-grow-1 mb-0"},K={class:"d-flex align-items-center"},L={class:"flex-grow-1"},Q={class:"d-flex align-items-center mb-2"},U={class:"fs-4 flex-grow-1 mb-0"},W={class:"d-flex align-items-center"},X={class:"flex-grow-1"},Y={class:"d-flex align-items-center mb-2"},Z={class:"fs-4 flex-grow-1 mb-0"},$={class:"d-flex align-items-center"},ee={class:"flex-grow-1"},te={class:"d-flex align-items-center mb-2"},ae={class:"fs-4 flex-grow-1 mb-0"};function se(a,t,d,o,l,r){const x=p("SaveToSnapshotButton"),u=p("BCardBody"),f=p("BCard"),m=p("BCol"),_=p("BRow"),b=p("apexchart"),C=p("CampaignMetricsTable");return T(),R("div",null,[e("div",N,[t[0]||(t[0]=e("h4",null,"Campaign Performance",-1)),s(x,{data:o.metrics,"data-type":"campaign"},null,8,["data"])]),s(_,{class:"mb-4"},{default:n(()=>[s(m,{md:"4",xl:"2"},{default:n(()=>[s(f,{class:"card-animate"},{default:n(()=>[s(u,null,{default:n(()=>[e("div",M,[e("div",A,[t[1]||(t[1]=e("p",{class:"text-uppercase fw-medium text-muted mb-0"},"Sends",-1)),e("div",O,[e("h4",z,c(o.metrics.currentPeriod.totals.emails_sent),1),e("span",{class:v(["badge",r.getPercentageClass(r.emailSentChange)])},c(r.emailSentChange)+"% ",3)])]),t[2]||(t[2]=e("div",{class:"avatar-sm flex-shrink-0"},[e("span",{class:"avatar-title bg-soft-primary rounded fs-3"},[e("i",{class:"ri-mail-send-line"})])],-1))])]),_:1})]),_:1})]),_:1}),s(m,{md:"4",xl:"2"},{default:n(()=>[s(f,{class:"card-animate"},{default:n(()=>[s(u,null,{default:n(()=>[e("div",E,[e("div",V,[t[3]||(t[3]=e("p",{class:"text-uppercase fw-medium text-muted mb-0"},"Opens",-1)),e("div",I,[e("h4",j,c(o.metrics.currentPeriod.totals.emails_opened),1),e("span",{class:v(["badge",r.getPercentageClass(r.openRateChange)])},c(r.openRateChange)+"% ",3)])]),t[4]||(t[4]=e("div",{class:"avatar-sm flex-shrink-0"},[e("span",{class:"avatar-title bg-soft-success rounded fs-3"},[e("i",{class:"ri-mail-open-line text-success"})])],-1))])]),_:1})]),_:1})]),_:1}),s(m,{md:"4",xl:"2"},{default:n(()=>[s(f,{class:"card-animate"},{default:n(()=>[s(u,null,{default:n(()=>[e("div",H,[e("div",q,[t[5]||(t[5]=e("p",{class:"text-uppercase fw-medium text-muted mb-0"},"Click-throughs",-1)),e("div",G,[e("h4",J,c(o.metrics.currentPeriod.totals.clicks),1),e("span",{class:v(["badge",r.getPercentageClass(r.clickRateChange)])},c(r.clickRateChange)+"% ",3)])]),t[6]||(t[6]=e("div",{class:"avatar-sm flex-shrink-0"},[e("span",{class:"avatar-title bg-soft-warning rounded fs-3"},[e("i",{class:"ri-cursor-line text-warning"})])],-1))])]),_:1})]),_:1})]),_:1}),s(m,{md:"4",xl:"2"},{default:n(()=>[s(f,{class:"card-animate"},{default:n(()=>[s(u,null,{default:n(()=>[e("div",K,[e("div",L,[t[7]||(t[7]=e("p",{class:"text-uppercase fw-medium text-muted mb-0"},"CTR",-1)),e("div",Q,[e("h4",U,c(o.metrics.currentPeriod.rates.click_through_rate)+"%",1),e("span",{class:v(["badge",r.getPercentageClass(r.clickRateChange)])},c(r.clickRateChange)+"% ",3)])]),t[8]||(t[8]=e("div",{class:"avatar-sm flex-shrink-0"},[e("span",{class:"avatar-title bg-soft-info rounded fs-3"},[e("i",{class:"ri-percent-line text-info"})])],-1))])]),_:1})]),_:1})]),_:1}),s(m,{md:"4",xl:"2"},{default:n(()=>[s(f,{class:"card-animate"},{default:n(()=>[s(u,null,{default:n(()=>[e("div",W,[e("div",X,[t[9]||(t[9]=e("p",{class:"text-uppercase fw-medium text-muted mb-0"},"Entries",-1)),e("div",Y,[e("h4",Z,c(o.metrics.currentPeriod.totals.entries),1),e("span",{class:v(["badge",r.getPercentageClass(a.entryRateChange)])},c(a.entryRateChange)+"% ",3)])]),t[10]||(t[10]=e("div",{class:"avatar-sm flex-shrink-0"},[e("span",{class:"avatar-title bg-soft-danger rounded fs-3"},[e("i",{class:"ri-login-circle-line text-danger"})])],-1))])]),_:1})]),_:1})]),_:1}),s(m,{md:"4",xl:"2"},{default:n(()=>[s(f,{class:"card-animate"},{default:n(()=>[s(u,null,{default:n(()=>[e("div",$,[e("div",ee,[t[11]||(t[11]=e("p",{class:"text-uppercase fw-medium text-muted mb-0"},"Conversions",-1)),e("div",te,[e("h4",ae,c(o.metrics.currentPeriod.totals.conversions),1),e("span",{class:v(["badge",r.getPercentageClass(a.conversionRateChange)])},c(a.conversionRateChange)+"% ",3)])]),t[12]||(t[12]=e("div",{class:"avatar-sm flex-shrink-0"},[e("span",{class:"avatar-title bg-soft-success rounded fs-3"},[e("i",{class:"ri-exchange-dollar-line text-success"})])],-1))])]),_:1})]),_:1})]),_:1})]),_:1}),s(_,null,{default:n(()=>[s(m,{lg:"8"},{default:n(()=>[s(b,{class:"apex-charts",height:"350",series:o.performanceData.series,options:o.performanceData.chartOptions},null,8,["series","options"])]),_:1})]),_:1}),s(_,{class:"mt-4"},{default:n(()=>[s(m,{lg:"12"},{default:n(()=>[s(C,{metrics:o.metrics},null,8,["metrics"])]),_:1})]),_:1})])}const ue=D(F,[["render",se]]);export{ue as default};
