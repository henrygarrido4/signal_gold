import{L as Q}from"./main-BZMVmuB9.js";import{P as $}from"./page-header-CWp0LBfO.js";import{P as ee,r as l,o as c,c as S,w as s,a,f as i,h as f,n as _,t as p,Z as te,b as w,s as oe,H as U,d as g,g as Y,F as O,e as h,k as ne}from"./app-BWABJYdq.js";import{C as ae}from"./component-GK_D4hhz.js";/* empty css                  */import{S as A}from"./sweetalert2.esm.all-CumHaNCI.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as se}from"./default-Jr7rUdQV.js";import"./simplebar-vue.esm-CZuBtKrH.js";import"./avatar-2-C9CWE8xV.js";import"./avatar-3-CcIxMpdW.js";import"./avatar-5-BPjc6EDL.js";import"./russia-pMTSjNGF.js";import"./logo-signal-9z7U6Iga.js";import"./logo-dark-BbIT5rJd.js";import"./logo-light-BfYujB8V.js";const le=ee({name:"EventCard",props:{log:{type:Object,required:!0}},methods:{getStatusClass(o){return{"bg-success-subtle":o==="running","bg-warning-subtle":o==="scheduled","bg-info-subtle":o==="completed","bg-primary-subtle":o==="pending"}},getStatusBadgeClass(o){return{"badge-soft-success":o==="running","badge-soft-warning":o==="scheduled","badge-soft-info":o==="completed","badge-soft-primary":o==="pending"}},getIconClass(o){return{"text-success":o==="running","text-warning":o==="scheduled","text-info":o==="completed","text-primary":o==="pending"}}},emits:["edit","delete"]}),re={class:"mb-4 pb-2"},ie={class:"avatar-sm"},de={class:"fs-15 fw-semibold"},me={class:"text-muted mb-2"},ce={class:"text-muted mb-0 small"};function ue(o,t,F,e,x,k){const b=l("BDropdownItem"),r=l("BDropdown"),M=l("BLink"),u=l("BCardBody"),y=l("BCard");return c(),S(y,{"no-body":"",class:_(["card-height-100",[o.getStatusClass(o.log.status),"shadow-none","bg-opacity-10"]])},{default:s(()=>[a(u,null,{default:s(()=>[a(r,{variant:"link",right:"","toggle-class":"text-decoration-none arrow-none p-0",class:"float-end","no-caret":""},{"button-content":s(()=>t[2]||(t[2]=[i("span",{class:"text-muted fs-18"},[i("i",{class:"mdi mdi-dots-vertical"})],-1)])),default:s(()=>[a(b,{onClick:t[0]||(t[0]=D=>o.$emit("edit",o.log))},{default:s(()=>t[3]||(t[3]=[f("Edit")])),_:1}),a(b,{onClick:t[1]||(t[1]=D=>o.$emit("delete",o.log))},{default:s(()=>t[4]||(t[4]=[f("Delete")])),_:1})]),_:1}),i("div",re,[i("div",ie,[i("span",{class:_(["avatar-title rounded-circle",o.getStatusClass(o.log.status)])},[i("i",{class:_([o.log.icon_class,"fs-4",o.getIconClass(o.log.status)])},null,2)],2)])]),a(M,{href:"#!"},{default:s(()=>[i("h6",de,[f(p(o.log.title)+" ",1),i("span",{class:_(["badge rounded-pill ms-1",o.getStatusBadgeClass(o.log.status)])},p(o.log.status.charAt(0).toUpperCase()+o.log.status.slice(1)),3)])]),_:1}),i("p",me,p(o.log.description),1),i("p",ce,[t[5]||(t[5]=i("i",{class:"ri-calendar-line align-bottom me-1"},null,-1)),f(" "+p(new Date(o.log.timestamp).toLocaleString("en-US",{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0})),1)])]),_:1})]),_:1},8,["class"])}const pe=G(le,[["render",ue],["__scopeId","data-v-f480b385"]]),ve={components:{Layout:Q,PageHeader:$,Head:te,flatPickr:ae,EventCard:pe,Multiselect:se},setup(){const o=w([]),t=w(!1),F=w({campaign_id:"",event_type:"",date_from:"",date_to:""}),e=[{value:"",text:"All Events"},{value:"ab_test",text:"A/B Tests"},{value:"campaign_launch",text:"Campaigns"},{value:"subject_test",text:"Subject Tests"},{value:"automation",text:"Automations"}],x=w(!1),k=w(!1),b=w(null),r=w({title:"",description:"",timestamp:"",status:"scheduled",event_type:""}),M={enableTime:!0,dateFormat:"Y-m-d h:i K",time_24hr:!1,allowInput:!0,altFormat:"F j, Y at h:i K",altInput:!0,minuteIncrement:1,defaultHour:new Date().getHours(),defaultMinute:new Date().getMinutes(),amPM:!0},u=w({}),y=async()=>{var d;t.value=!0;try{const m=await U.get("/api/campaign-logs",{params:F.value,headers:{"X-Requested-With":"XMLHttpRequest"}});o.value=m.data.data}catch(m){console.error("Failed to fetch logs:",m),((d=m.response)==null?void 0:d.status)===401&&(window.location.href="/login")}finally{t.value=!1}},D=d=>({"bg-success-subtle text-success":d==="running","bg-warning-subtle text-warning":d==="scheduled","bg-info-subtle text-info":d==="completed","bg-primary-subtle text-primary":d==="pending"}),L=()=>{r.value={title:"",description:"",timestamp:"",status:"scheduled",event_type:""},k.value=!1,b.value=null},I=d=>{b.value=d;const m=new Date(d.timestamp);r.value={...d,timestamp:m},k.value=!0,x.value=!0},N=async d=>{var m,B;try{(await A.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel!",confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a"})).isConfirmed&&(await U.delete(`/api/campaign-logs/${d.id}`),await y(),A.fire({title:"Deleted!",text:"Event has been deleted.",icon:"success",showConfirmButton:!1,timer:1500,timerProgressBar:!0}))}catch(E){console.error("Failed to delete event:",E),A.fire({icon:"error",title:"Error",text:((B=(m=E.response)==null?void 0:m.data)==null?void 0:B.message)||"Failed to delete event",confirmButtonText:"Ok",confirmButtonColor:"#34c38f"})}},R=async()=>{var d,m,B,E,T,P,H,q,n,V;if(u.value={},(d=r.value.title)!=null&&d.trim()||(u.value.title="Title is required"),(m=r.value.description)!=null&&m.trim()||(u.value.description="Description is required"),r.value.timestamp||(u.value.timestamp="Date & Time is required"),r.value.status||(u.value.status="Status is required"),r.value.event_type||(u.value.event_type="Event Type is required"),!(Object.keys(u.value).length>0))try{t.value=!0;const v=new Date(r.value.timestamp),j=v.getHours(),K=v.getMinutes(),X=j>=12?"PM":"AM",W=j%12||12,Z=K.toString().padStart(2,"0"),J=`${v.getFullYear()}-${(v.getMonth()+1).toString().padStart(2,"0")}-${v.getDate().toString().padStart(2,"0")} ${W}:${Z} ${X}`,z={title:r.value.title.trim(),description:r.value.description.trim(),timestamp:J,status:((B=r.value.status)==null?void 0:B.value)||r.value.status,event_type:((E=r.value.event_type)==null?void 0:E.value)||r.value.event_type};try{if(k.value){const C=await U.put(`/api/campaign-logs/${b.value.id}`,z)}else{const C=await U.post("/api/campaign-logs",z)}}catch(C){throw console.error("API Error:",{status:(T=C.response)==null?void 0:T.status,statusText:(P=C.response)==null?void 0:P.statusText,data:(H=C.response)==null?void 0:H.data,error:C.message}),C}x.value=!1,L(),await y()}catch(v){console.error("Failed to save event:",v),(q=v.response)!=null&&q.data&&console.error("Error response data:",v.response.data),A.fire({icon:"error",title:"Error",text:((V=(n=v.response)==null?void 0:n.data)==null?void 0:V.message)||"Failed to save event",confirmButtonText:"Ok",confirmButtonColor:"#34c38f"})}finally{t.value=!1}};return oe(y),{logs:o,loading:t,filters:F,fetchLogs:y,eventTypes:e,getStatusClass:D,showEventModal:x,newEvent:r,dateConfig:M,handleSubmit:R,openEditModal:I,deleteEvent:N,isEditing:k,resetForm:L,formErrors:u}}},fe={class:"flex-shrink-0 d-flex gap-2"},ge={key:1,class:"ms-2"},_e={key:2,class:"text-muted mb-0"},be={key:0,class:"invalid-feedback"},ye={key:0,class:"invalid-feedback"},Ee={key:0,class:"invalid-feedback"},we={class:"position-relative"},Be={key:0,class:"invalid-feedback"},Ce={class:"position-relative"},he={key:0,class:"invalid-feedback"},ke={class:"hstack gap-2 justify-content-end"};function Se(o,t,F,e,x,k){const b=l("PageHeader"),r=l("BButton"),M=l("BDropdownItem"),u=l("BDropdown"),y=l("BCardBody"),D=l("BCard"),L=l("EventCard"),I=l("BCol"),N=l("BSpinner"),R=l("BRow"),d=l("BFormInput"),m=l("BFormGroup"),B=l("BFormTextarea"),E=l("flat-pickr"),T=l("Multiselect"),P=l("BForm"),H=l("BModal"),q=l("Layout");return c(),S(q,null,{default:s(()=>[a(b,{title:"Campaign Activity Logs",pageTitle:"Marketing CRM"}),a(D,{class:"mb-4"},{default:s(()=>[a(y,{class:"d-flex align-items-center p-3"},{default:s(()=>[t[11]||(t[11]=i("div",{class:"flex-grow-1"},[i("h5",{class:"card-title mb-0"},"Campaign Events")],-1)),i("div",fe,[a(r,{variant:"primary",size:"sm",onClick:t[0]||(t[0]=n=>e.showEventModal=!0)},{default:s(()=>t[8]||(t[8]=[i("i",{class:"ri-add-line align-bottom me-1"},null,-1),f(" New Event ")])),_:1}),a(u,{variant:"soft-primary",size:"sm"},{"button-content":s(()=>{var n;return[t[9]||(t[9]=i("i",{class:"ri-filter-line me-1"},null,-1)),f(" "+p(e.filters.event_type?(n=e.eventTypes.find(V=>V.value===e.filters.event_type))==null?void 0:n.text:"Filter Events"),1)]}),default:s(()=>[(c(!0),g(O,null,Y(e.eventTypes,n=>(c(),S(M,{key:n.value,onClick:V=>{e.filters.event_type=n.value,e.fetchLogs()},active:e.filters.event_type===n.value},{default:s(()=>[f(p(n.text),1)]),_:2},1032,["onClick","active"]))),128))]),_:1}),a(r,{variant:"soft-primary",size:"sm",onClick:e.fetchLogs},{default:s(()=>t[10]||(t[10]=[i("i",{class:"ri-refresh-line align-bottom"},null,-1),f(" Refresh ")])),_:1},8,["onClick"])])]),_:1})]),_:1}),a(R,null,{default:s(()=>[(c(!0),g(O,null,Y(e.logs,n=>(c(),S(I,{key:n.id,xl:"3",md:"6"},{default:s(()=>[a(L,{log:n,onEdit:e.openEditModal,onDelete:e.deleteEvent},null,8,["log","onEdit","onDelete"])]),_:2},1024))),128)),e.loading||e.logs.length===0?(c(),S(I,{key:0,cols:"12",class:"text-center"},{default:s(()=>[e.loading?(c(),S(N,{key:0,class:"align-middle"})):h("",!0),e.loading?(c(),g("strong",ge,"Loading...")):(c(),g("p",_e,"No events found"))]),_:1})):h("",!0)]),_:1}),a(H,{modelValue:e.showEventModal,"onUpdate:modelValue":t[7]||(t[7]=n=>e.showEventModal=n),title:e.isEditing?"Edit Event":"Create New Event","hide-footer":"",class:"v-modal-custom","modal-class":"zoomIn",centered:"","header-class":"p-3 bg-success-subtle"},{default:s(()=>[a(P,{onSubmit:ne(e.handleSubmit,["prevent"])},{default:s(()=>[a(m,{label:"Event Title",class:"mb-3"},{default:s(()=>[a(d,{modelValue:e.newEvent.title,"onUpdate:modelValue":t[1]||(t[1]=n=>e.newEvent.title=n),required:"",placeholder:"Enter event title",class:_({"is-invalid":e.formErrors.title})},null,8,["modelValue","class"]),e.formErrors.title?(c(),g("div",be,p(e.formErrors.title),1)):h("",!0)]),_:1}),a(m,{label:"Description",class:"mb-3"},{default:s(()=>[a(B,{modelValue:e.newEvent.description,"onUpdate:modelValue":t[2]||(t[2]=n=>e.newEvent.description=n),placeholder:"Enter event description",rows:"3",class:_({"is-invalid":e.formErrors.description})},null,8,["modelValue","class"]),e.formErrors.description?(c(),g("div",ye,p(e.formErrors.description),1)):h("",!0)]),_:1}),a(m,{label:"Date & Time",class:"mb-3"},{default:s(()=>[a(E,{modelValue:e.newEvent.timestamp,"onUpdate:modelValue":t[3]||(t[3]=n=>e.newEvent.timestamp=n),config:e.dateConfig,class:_(["form-control",{"is-invalid":e.formErrors.timestamp}]),placeholder:"Select date and time"},null,8,["modelValue","config","class"]),e.formErrors.timestamp?(c(),g("div",Ee,p(e.formErrors.timestamp),1)):h("",!0)]),_:1}),a(m,{label:"Status",class:"mb-3"},{default:s(()=>[i("div",we,[a(T,{modelValue:e.newEvent.status,"onUpdate:modelValue":t[4]||(t[4]=n=>e.newEvent.status=n),options:[{value:"scheduled",label:"Scheduled"},{value:"running",label:"Running"},{value:"completed",label:"Completed"},{value:"pending",label:"Pending"}],"track-by":"value",label:"label",placeholder:"Select status",searchable:!1,class:_({"is-invalid":e.formErrors.status})},null,8,["modelValue","class"]),e.formErrors.status?(c(),g("div",Be,p(e.formErrors.status),1)):h("",!0)])]),_:1}),a(m,{label:"Event Type",class:"mb-3"},{default:s(()=>[i("div",Ce,[a(T,{modelValue:e.newEvent.event_type,"onUpdate:modelValue":t[5]||(t[5]=n=>e.newEvent.event_type=n),options:e.eventTypes.filter(n=>n.value!=="").map(n=>({value:n.value,label:n.text})),"track-by":"value",label:"label",placeholder:"Select event type",searchable:!1,class:_({"is-invalid":e.formErrors.event_type})},null,8,["modelValue","options","class"]),e.formErrors.event_type?(c(),g("div",he,p(e.formErrors.event_type),1)):h("",!0)])]),_:1}),i("div",ke,[a(r,{variant:"light",onClick:t[6]||(t[6]=n=>e.showEventModal=!1)},{default:s(()=>t[12]||(t[12]=[f(" Cancel ")])),_:1}),a(r,{type:"submit",variant:"primary",disabled:e.loading},{default:s(()=>[f(p(e.isEditing?"Update":"Create"),1)]),_:1},8,["disabled"])])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue","title"])]),_:1})}const ze=G(ve,[["render",Se],["__scopeId","data-v-20e4d973"]]);export{ze as default};
